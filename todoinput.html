<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>MyTodoList(input)</title>
    <script src="js/jquery-2.1.3.min.js"></script>
    <link rel="stylesheet" href="css/sample.css">
</head>

<body>
    <header>
        <h1>TODO入力画面</h1>
    </header>
    <main>

        <table class="table1">
            <tr>
                <td class="head">登録日</td>
                <td colspan="3" class="head">Todo内容</td>
                <td class="head">Todo期限</td>
                <td class="head">済</td>
                <td rowspan="6">
                    <table class="table1">
                        <tr>
                            <td class="head">項番</td>
                            <td class="head">内容記入欄</td>
                            <td class="head">期限欄</td>
                            <td class="head">済</td>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td><input type="text" id="meitxt01" size="30" class="clr" /></td>
                            <td><input type="date" id="meilimit01" class="clr" /></td>
                            <td><input type="checkbox" id="meisumi01" class="clr" /></td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td><input type="text" id="meitxt02" size="30" class="clr" /></td>
                            <td><input type="date" id="meilimit02" class="clr" /></td>
                            <td><input type="checkbox" id="meisumi02" class="clr" /></td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td><input type="text" id="meitxt03" size="30" class="clr" /></td>
                            <td><input type="date" id="meilimit03" class="clr" /></td>
                            <td><input type="checkbox" id="meisumi03" class="clr" /></td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td><input type="text" id="meitxt04" size="30" class="clr" /></td>
                            <td><input type="date" id="meilimit04" class="clr" /></td>
                            <td><input type="checkbox" id="meisumi04" class="clr" /></td>
                        </tr>
                        <tr>
                            <td>5</td>
                            <td><input type="text" id="meitxt05" size="30" class="clr" /></td>
                            <td><input type="date" id="meilimit05" class="clr" /></td>
                            <td><input type="checkbox" id="meisumi05" class="clr" /></td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td><input type="text" id="meitxt06" size="30" class="clr" /></td>
                            <td><input type="date" id="meilimit06" class="clr" /></td>
                            <td><input type="checkbox" id="meisumi06" class="clr" /></td>
                        </tr>
                        <tr>
                            <td>7</td>
                            <td><input type="text" id="meitxt07" size="30" class="clr" /></td>
                            <td><input type="date" id="meilimit07" class="clr" /></td>
                            <td><input type="checkbox" id="meisumi07" class="clr" /></td>
                        </tr>
                        <tr>
                            <td>8</td>
                            <td><input type="text" id="meitxt08" size="30" class="clr" /></td>
                            <td><input type="date" id="meilimit08" class="clr" /></td>
                            <td><input type="checkbox" id="meisumi08" class="clr" /></td>
                        </tr>
                        <tr>
                            <td>9</td>
                            <td><input type="text" id="meitxt09" size="30" class="clr" /></td>
                            <td><input type="date" id="meilimit09" class="clr" /></td>
                            <td><input type="checkbox" id="meisumi09" class="clr" /></td>
                        </tr>
                        <tr>
                            <td>10</td>
                            <td><input type="text" id="meitxt10" size="30" class="clr" /></td>
                            <td><input type="date" id="meilimit10" class="clr" /></td>
                            <td><input type="checkbox" id="meisumi10" class="clr" /></td>
                        </tr>

                    </table>
                </td>
            </tr>
            <tr>
                <td><input type="date" id="tododate" value="" class="clr" /></td>
                <td colspan="3"><input type="text" id="todotext" size="40" value="" class="clr" /></td>
                <td><input type="date" id="todolimit" class="clr" /></td>
                <td><input type="checkbox" id="todosumi" class="clr" /></td>
            </tr>
            <tr>
                <td class="head">テンプレ化</td>
                <td class="head">テンプレタイトル</td>
                <td class="head">テーマカラー</td>
                <td colspan="3" class="head">担当者</td>
            </tr>
            <tr>
                <td><input type="checkbox" id="templck" class="clr" /></td>
                <td><input type="text" id="temptext" size="15" class="clr" /></td>
                <td><input type="color" id="todocolor" /></td>
                <td colspan="3"><input type="text" id="tantou" size="15" class="clr" /></td>
            </tr>
            <tr>
                <td colspan="6" class="head">説明欄</td>
            </tr>
            <td colspan="6"><textarea name="tododetail" id="tododetail" class="clr"></textarea></td>
        </table>
        TODOナンバー:
        <input type="number" id="todono" name="todono" required minlength="5" maxlength="5" size="5" />
        <button id="save">登録</button>
        <button id="reset">リセット</button>
        <button id="deltodo">削除</button>
        <div class="linkbot">
            <button onclick="location.href='todolist.html'" class="tolink">todo一覧へ</button>
            <button onclick="location.href='index.html'" class="tolink">indexへ</button>
        </div>
    </main>
    <!-- <main>
        <input id="key" type="text">
        <textarea id="memo"></textarea>
        <ul>
            <li id="save">Save</li>
            <li dir="clear">Clear</li>
        </ul>
    </main> -->
    <table id="list">
        <!-- ここに追加データが挿入される -->
    </table>
    <script>

        window.onload = function () {
            const urlParams = new URLSearchParams(window.location.search);
            const inputData = urlParams.get('todono'); // 'data'という名前のパラメータを取得
            if (inputData) {
                document.getElementById('todono').value = inputData;
            }

            const elements = document.querySelectorAll('.clr, .clr textarea, .clr select');
            elements.forEach(element => {
                // input, textarea, select要素に対応
                if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA' || element.tagName === 'SELECT') {
                    element.value = '';
                }
            });
            todocolor.value = "#000000";

            for (let i = 0; i < localStorage.length; i++) {
                const todono_ = document.getElementById("todono").value;
                const key = localStorage.key(i); //KEY名を取得
                const storagevalue = localStorage.getItem(key); //Valueを取得
                const partBeforeUnderscore = key.split('_')[0];
                const partAferUnderscore = key.split('_')[1];
                if (partBeforeUnderscore == todono.value) {
                    const inputElement = document.getElementById(partAferUnderscore);
                    if (inputElement && inputElement.tagName.toLowerCase() === 'input') {
                        inputElement.value = storagevalue;
                        console.log(`Key "${key}" processed. Set input #${partAferUnderscore} value to "${storagevalue}".`);
                    }
                    if (inputElement && inputElement.tagName.toLowerCase() === "textarea") {
                        inputElement.value = storagevalue;
                        console.log(`Key "${key}" processed. Set input #${partAferUnderscore} value to "${storagevalue}".`);
                    }
                }
            };

        }


        //1.Save クリックイベント
        // $("#save").on("click", function () {
        //     const key = $("#key").val();//入力内容を取得 Value
        //     const value = $("#memo").val();//
        //     localStorage.setItem(key, value);//保存
        //     const html = '<tr><td>' + key + '</td><td>' + value + '</td></tr>';
        //     $("#list").append(html);//appendとは、差し込み関数！
        // });
        $("#save").on("click", function () {
            const todono_ = document.getElementById("todono").value;

            const tododate_ = document.getElementById("tododate").value;
            const numtododate = `${todono_}_tododate`;
            localStorage.setItem(numtododate, tododate.value);

            const todotext_ = document.getElementById("todotext").value;
            const numtodotext = `${todono_}_todotext`;
            localStorage.setItem(numtodotext, todotext.value);

            const todolimit_ = document.getElementById("todolimit").value;
            const numtodolimit = `${todono_}_todolimit`;
            localStorage.setItem(numtodolimit, todolimit.value);

            const todosumi_ = document.getElementById("todosumi").value;
            const numtodosumi = `${todono_}_todosumi`;
            localStorage.setItem(numtodosumi, todosumi.value);

            const templck_ = document.getElementById("templck").value;
            const numtemplck = `${todono_}_templck`;
            localStorage.setItem(numtemplck, templck.value);

            const temptext_ = document.getElementById("temptext").value;
            const numtemptext = `${todono_}_temptext`;
            localStorage.setItem(numtemptext, temptext.value);

            const todocolor_ = document.getElementById("todocolor").value;
            const numtodocolor = `${todono_}_todocolor`;
            localStorage.setItem(numtodocolor, todocolor.value);

            const tantou_ = document.getElementById("tantou").value;
            const numtantou = `${todono_}_tantou`;
            localStorage.setItem(numtantou, tantou.value);

            const tododetail_ = document.getElementById("tododetail").value;
            const numtododetail = `${todono_}_tododetail`;
            localStorage.setItem(numtododetail, tododetail.value);

            const meitxt01_ = document.getElementById("meitxt01").value;
            const nummeitxt01 = `${todono_}_meitxt01`;
            localStorage.setItem(nummeitxt01, meitxt01.value);
            const meilimit01_ = document.getElementById("meilimit01").value;
            const nummeilimit01 = `${todono_}_meilimit01`;
            localStorage.setItem(nummeilimit01, meilimit01.value);
            const meisumi01_ = document.getElementById("meisumi01").value;
            const nummeisumi01 = `${todono_}_meisumi01`;
            localStorage.setItem(nummeisumi01, meisumi01.value);

            const meitxt02_ = document.getElementById("meitxt02").value;
            const nummeitxt02 = `${todono_}_meitxt02`;
            localStorage.setItem(nummeitxt02, meitxt02.value);
            const meilimit02_ = document.getElementById("meilimit02").value;
            const nummeilimit02 = `${todono_}_meilimit02`;
            localStorage.setItem(nummeilimit02, meilimit02.value);
            const meisumi02_ = document.getElementById("meisumi02").value;
            const nummeisumi02 = `${todono_}_meisumi02`;
            localStorage.setItem(nummeisumi02, meisumi02.value);

            const meitxt03_ = document.getElementById("meitxt03").value;
            const nummeitxt03 = `${todono_}_meitxt03`;
            localStorage.setItem(nummeitxt03, meitxt03.value);
            const meilimit03_ = document.getElementById("meilimit03").value;
            const nummeilimit03 = `${todono_}_meilimit03`;
            localStorage.setItem(nummeilimit03, meilimit03.value);
            const meisumi03_ = document.getElementById("meisumi03").value;
            const nummeisumi03 = `${todono_}_meisumi03`;
            localStorage.setItem(nummeisumi03, meisumi03.value);

            const meitxt04_ = document.getElementById("meitxt04").value;
            const nummeitxt04 = `${todono_}_meitxt04`;
            localStorage.setItem(nummeitxt04, meitxt04.value);
            const meilimit04_ = document.getElementById("meilimit04").value;
            const nummeilimit04 = `${todono_}_meilimit04`;
            localStorage.setItem(nummeilimit04, meilimit04.value);
            const meisumi04_ = document.getElementById("meisumi04").value;
            const nummeisumi04 = `${todono_}_meisumi04`;
            localStorage.setItem(nummeisumi04, meisumi04.value);

            const meitxt05_ = document.getElementById("meitxt05").value;
            const nummeitxt05 = `${todono_}_meitxt05`;
            localStorage.setItem(nummeitxt05, meitxt05.value);
            const meilimit05_ = document.getElementById("meilimit05").value;
            const nummeilimit05 = `${todono_}_meilimit05`;
            localStorage.setItem(nummeilimit05, meilimit05.value);
            const meisumi05_ = document.getElementById("meisumi05").value;
            const nummeisumi05 = `${todono_}_meisumi05`;
            localStorage.setItem(nummeisumi05, meisumi05.value);

            const meitxt06_ = document.getElementById("meitxt06").value;
            const nummeitxt06 = `${todono_}_meitxt06`;
            localStorage.setItem(nummeitxt06, meitxt06.value);
            const meilimit06_ = document.getElementById("meilimit06").value;
            const nummeilimit06 = `${todono_}_meilimit06`;
            localStorage.setItem(nummeilimit06, meilimit06.value);
            const meisumi06_ = document.getElementById("meisumi06").value;
            const nummeisumi06 = `${todono_}_meisumi06`;
            localStorage.setItem(nummeisumi06, meisumi06.value);

            const meitxt07_ = document.getElementById("meitxt07").value;
            const nummeitxt07 = `${todono_}_meitxt07`;
            localStorage.setItem(nummeitxt07, meitxt07.value);
            const meilimit07_ = document.getElementById("meilimit07").value;
            const nummeilimit07 = `${todono_}_meilimit07`;
            localStorage.setItem(nummeilimit07, meilimit07.value);
            const meisumi07_ = document.getElementById("meisumi07").value;
            const nummeisumi07 = `${todono_}_meisumi07`;
            localStorage.setItem(nummeisumi07, meisumi07.value);
            const meitxt08_ = document.getElementById("meitxt08").value;

            const nummeitxt08 = `${todono_}_meitxt08`;
            localStorage.setItem(nummeitxt08, meitxt08.value);
            const meilimit08_ = document.getElementById("meilimit08").value;
            const nummeilimit08 = `${todono_}_meilimit08`;
            localStorage.setItem(nummeilimit08, meilimit08.value);
            const meisumi08_ = document.getElementById("meisumi08").value;
            const nummeisumi08 = `${todono_}_meisumi08`;
            localStorage.setItem(nummeisumi08, meisumi08.value);

            const meitxt09_ = document.getElementById("meitxt09").value;
            const nummeitxt09 = `${todono_}_meitxt09`;
            localStorage.setItem(nummeitxt09, meitxt09.value);
            const meilimit09_ = document.getElementById("meilimit09").value;
            const nummeilimit09 = `${todono_}_meilimit09`;
            localStorage.setItem(nummeilimit09, meilimit09.value);
            const meisumi09_ = document.getElementById("meisumi09").value;
            const nummeisumi09 = `${todono_}_meisumi09`;
            localStorage.setItem(nummeisumi09, meisumi09.value);

            const meitxt10_ = document.getElementById("meitxt10").value;
            const nummeitxt10 = `${todono_}_meitxt10`;
            localStorage.setItem(nummeitxt10, meitxt10.value);
            const meilimit10_ = document.getElementById("meilimit10").value;
            const nummeilimit10 = `${todono_}_meilimit10`;
            localStorage.setItem(nummeilimit10, meilimit10.value);
            const meisumi10_ = document.getElementById("meisumi10").value;
            const nummeisumi10 = `${todono_}_meisumi10`;
            localStorage.setItem(nummeisumi10, meisumi10.value);
        });



        //リセット クリックイベント
        $("#reset").on("click", function () {
            const elements = document.querySelectorAll('.clr, .clr textarea, .clr select');
            elements.forEach(element => {
                // input, textarea, select要素に対応
                if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA' || element.tagName === 'SELECT') {
                    element.value = '';
                }
            });
            todocolor.value = "#000000";
            for (let i = 0; i < localStorage.length; i++) {
                const todono_ = document.getElementById("todono").value;
                const key = localStorage.key(i); //KEY名を取得
                const storagevalue = localStorage.getItem(key); //Valueを取得
                const partBeforeUnderscore = key.split('_')[0];
                const partAferUnderscore = key.split('_')[1];
                if (partBeforeUnderscore == todono.value) {
                    const inputElement = document.getElementById(partAferUnderscore);
                    if (inputElement && inputElement.tagName.toLowerCase() === 'input') {
                        inputElement.value = storagevalue;
                        console.log(`Key "${key}" processed. Set input #${partAferUnderscore} value to "${storagevalue}".`);
                    }
                    if (inputElement && inputElement.tagName.toLowerCase() === "textarea") {
                        inputElement.value = storagevalue;
                        console.log(`Key "${key}" processed. Set input #${partAferUnderscore} value to "${storagevalue}".`);
                    }
                }

            }

            //デリート　クリックイベント
            $("#deltodo").on("click", function () {
                const deltodono = document.getElementById("todono").value;
                console.log(deltodono);
                // 削除対象のキーを一時的に格納する配列
                const keysToRemove = [];

                // localStorageのすべてのキーをループ処理
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    // キーが指定されたプレフィックスで始まるかチェック
                    if (key.startsWith(deltodono)) {
                        keysToRemove.push(key);
                    }
                }
                // 削除対象のキー配列をループ処理し、removeItem()で個別に削除
                for (const key of keysToRemove) {
                    localStorage.removeItem(key);
                }

                const elements = document.querySelectorAll('.clr, .clr textarea, .clr select');
                elements.forEach(element => {
                    // input, textarea, select要素に対応
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA' || element.tagName === 'SELECT') {
                        element.value = '';
                    }
                });
                todocolor.value = "#000000";
                for (let i = 0; i < localStorage.length; i++) {
                    const todono_ = document.getElementById("todono").value;
                    const key = localStorage.key(i); //KEY名を取得
                    const storagevalue = localStorage.getItem(key); //Valueを取得
                    const partBeforeUnderscore = key.split('_')[0];
                    const partAferUnderscore = key.split('_')[1];
                    if (partBeforeUnderscore == todono.value) {
                        const inputElement = document.getElementById(partAferUnderscore);
                        if (inputElement && inputElement.tagName.toLowerCase() === 'input') {
                            inputElement.value = storagevalue;
                            console.log(`Key "${key}" processed. Set input #${partAferUnderscore} value to "${storagevalue}".`);
                        }
                        if (inputElement && inputElement.tagName.toLowerCase() === "textarea") {
                            inputElement.value = storagevalue;
                            console.log(`Key "${key}" processed. Set input #${partAferUnderscore} value to "${storagevalue}".`);
                        }
                    }

                }
            });


        });


        // const todono_ = document.getElementById("todono").value;
        // const tododate_ = document.getElementById("tododate").value;
        // const numtododate = `${todono_}_${tododate_}`;
        // const savetododate = localStorage.getItem("numtododate");
        // console.log(numtododate)
        // if (savetododate) {
        //     tododate.value = savetododate;
        // }





    </script>
    <footer><small>G's 課題 「メモ帳？」 by もりしん</small></footer>
</body>

</html>